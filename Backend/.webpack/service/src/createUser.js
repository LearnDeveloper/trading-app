(()=>{var e={336:e=>{"use strict";e.exports=require("aws-sdk")},13:e=>{"use strict";e.exports=require("mongodb")},184:e=>{"use strict";e.exports=require("nodemailer")}},o={};function r(t){var n=o[t];if(void 0!==n)return n.exports;var s=o[t]={exports:{}};return e[t](s,s.exports,r),s.exports}var t={};(()=>{var e=t;const{MongoClient:o}=r(13);r(336);var n=r(184);const s=new Date,a=Math.floor(1e3+9e3*Math.random());console.log(a);const i=Math.floor(67845*Math.random());console.log(i);const l=`LRN${i}`,c=s.getFullYear(),d=s.getMonth()+1,u=s.getDate(),p=s.getHours(),g=s.getMinutes(),f=s.getSeconds(),b=process.env.MONGODB_URI;let m=null;e.handler=async e=>{let r,t=JSON.parse(e.body);if(console.log("body",t),"create"==t.path)try{const e=t.email,s=t.Phone_Number;r=new o(b),await r.connect();const i=r.db("trading-app-dev").collection("LEARN_USERS"),y=await i.findOne({email:e}),h=await i.findOne({phoneNumber:s});if(y||h)return{statusCode:200,headers:{"Access-Control-Allow-Origin":"*"},body:JSON.stringify({error:"Email ID or Phone Number already exists",responseCode:"1001"})};{const e=await async function(){if(m)return m;const e=await o.connect(b),r=await e.db("trading-app-dev");m=r;const t=await r.collection("LEARN_USERS").find().sort({_id:-1}).limit(1).toArray();return e.close(),t}(),r=await async function(e){const o=e[0].user_id.split("_")[1];console.log("inputStr",o);const r=parseInt(o,10)+1,t=o.length,n=String(r).padStart(t,"0");return console.log(n),n}(e);return await async function(e,r){console.log("payload",r);try{const t=new o(b);await t.connect();const s=t.db("trading-app-dev"),i=s.collection("LEARN_USERS");let m={user_id:`learn_${e}`,full_name:r.full_name,Phone_Number:r.Phone_Number,email:r.email,password:r.password,device_info:{isMobile:r.device_info.isMobile,isTablet:r.device_info.isTablet,isDesktop:r.device_info.isDesktop,deviceType:r.device_info.deviceType,OS:r.device_info.OS,osVersion:r.device_info.osVersion,screen_resolution:r.device_info.screen_resolution,userAgent:r.device_info.userAgent},created_date:`${u}-${d}-${c}:${p}:${g}:${f}`,language:r.language,firebase_token:r.firebase_token,isActive:r.isActive,isBanned:!1,OTP:a,refferral_code:l,refferred_code:r.refferred_code,isDeleted:!1,isSubscribed:!0};console.log("data",m);let y=m.email;await i.insertOne(m);const h=await async function(e){const o=n.createTransport({service:"SMTP",host:"smtp.hostinger.com",port:465,secure:!0,auth:{user:"notify@l-earn.pro",pass:"Notify@2023l-earnPro"}});console.log("SMTP Configured");var r={from:"notify@l-earn.pro",to:e.email,subject:"Welcome to L-EARN",html:'<span style="text-align:left;background-color: linear-gradient(220deg, rgba(246,246,246,1) 50%, rgba(140,159,255,1) 100%)"><h1 style="padding:20px;"><b>Welcome to L-EARN</b></h1><p style="text-align:"left">Dear'+e.full_name+"</p><br><p>Thank you for signing up for our service. We are excited to have you as a member!</p><br><p>Here are some key details about your account:</p><br><ul><li>Email:"+e.full_name+"</li><li>Password:"+e.password+"</li><li>OTP:"+a+"</li></ul><br><p>If you have any questions or need assistance, please dont hesitate to contact us.</p><br><p>Best regards,<br>L-earn Team</p></span>"};return console.log("Sending Mail"),new Promise(((e,t)=>{o.sendMail(r,((o,r)=>{o?(t(o),console.error("Error sending email:",o)):(e(),console.log("Email sent:",r.response))}))}))}(r),_=await s.collection("LEARN_USERS").find({email:y}).toArray();return console.log(_),console.log(h),{statusCode:200,headers:{"Access-Control-Allow-Origin":"*"},body:JSON.stringify({message:"User created successfully",data:_,responseCode:"1000"})}}catch(e){return console.error("Error:",e),{statusCode:500,body:JSON.stringify({message:"Error creating user"})}}}(r,t)}}catch(e){return console.error("Error:",e),{statusCode:500,headers:{"Access-Control-Allow-Origin":"*"},body:JSON.stringify({error:"Internal Server Error from API"})}}finally{r&&r.close()}else if("resend"==t.path)return await async function(e){const o=n.createTransport({service:"SMTP",host:"smtp.hostinger.com",port:465,secure:!0,auth:{user:"notify@l-earn.pro",pass:"Notify@2023l-earnPro"}});console.log("SMTP Configured");var r={from:"notify@l-earn.pro",to:e.email,subject:"check",html:'<span style="text-align:left;background-color: linear-gradient(220deg, rgba(246,246,246,1) 50%, rgba(140,159,255,1) 100%)"><h1 style="padding:20px;"><b>Welcome to L-EARN</b></h1><br><p style="text-align:"left">Dear'+e.full_name+"</p><br><p>Hello "+e.email+" the OTP is "+a+"!</p><br><p>If you have any questions or need assistance, please dont hesitate to contact us.</p><br><p>Best regards,<br>L-earn Team</p></span>"};console.log("Sending Mail"),o.sendMail(r,(function(e){if(e)return console.log("Error occured"),void console.log(e.message)}))}(t)}})();var n=exports;for(var s in t)n[s]=t[s];t.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
//# sourceMappingURL=createUser.js.map